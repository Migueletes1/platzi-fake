<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Registrarse</title>
  <style>
    :root {
      --bg:#f6f8fb; --card:#ffffff; --accent:#27ae60; --muted:#666;
    }
    body{font-family:Inter,ui-sans-serif,system-ui; background:var(--bg); display:flex; align-items:center; justify-content:center; height:100vh; margin:0;}
    .card{width:400px; background:var(--card); padding:24px; border-radius:12px; box-shadow:0 6px 20px rgba(0,0,0,0.06);}
    h1{margin:0 0 12px 0; font-size:22px;}
    label{display:block; font-size:13px; margin-top:10px; color:var(--muted);}
    input{width:100%; padding:10px 12px; border:1px solid #e6e9ef; border-radius:8px; margin-top:6px; box-sizing:border-box;}
    button{margin-top:16px; width:100%; padding:10px; border-radius:8px; border:0; background:var(--accent); color:#fff; font-weight:600; cursor:pointer;}
    pre{background:#fafafa; padding:10px; border-radius:6px; margin-top:10px; overflow:auto; font-size:13px;}
    .hidden{display:none;}
    .links{margin-top:10px; text-align:center;}
    .links a{color:var(--accent); font-size:14px; text-decoration:none;}
  </style>
</head>
<body>
  <div class="card">
    <h1>Crear cuenta</h1>

    <form id="registerForm">
      <label for="username">Usuario</label>
      <input id="username" name="username" type="text" required />

      <label for="email">Correo electrónico</label>
      <input id="email" name="email" type="email" required />

      <label for="password">Contraseña</label>
      <input id="password" name="password" type="password" required />

      <label for="password2">Confirmar contraseña</label>
      <input id="password2" name="password2" type="password" required />

      <label for="first_name">Nombre</label>
      <input id="first_name" name="first_name" type="text" />

      <label for="last_name">Apellido</label>
      <input id="last_name" name="last_name" type="text" />

      <button type="submit">Registrarse</button>
    </form>

    <div class="links">
      <a href="/account/login/">¿Ya tienes cuenta? Inicia sesión</a>
    </div>

    <pre id="output" class="hidden">{}</pre>
  </div>

  <script>
    const REGISTER_URL = '/account/api/register/';

    const registerForm = document.getElementById('registerForm');
    const output = document.getElementById('output');

    function show(obj){
      output.classList.remove('hidden');
      try{ output.textContent = JSON.stringify(obj, null, 2); } catch(e){ output.textContent = String(obj); }
    }

    async function fetchJson(url, opts = {}){
      opts.headers = opts.headers || {};
      opts.headers['Content-Type'] = 'application/json';
      const res = await fetch(url, opts);
      const text = await res.text();
      try { return { status: res.status, ok: res.ok, data: JSON.parse(text || '{}') }; }
      catch(e){ return { status: res.status, ok: res.ok, data: text }; }
    }

    registerForm.addEventListener('submit', async (e) => {
      e.preventDefault();

      const body = JSON.stringify({
        username: document.getElementById('username').value.trim(),
        email: document.getElementById('email').value.trim(),
        password: document.getElementById('password').value,
        password2: document.getElementById('password2').value,
        first_name: document.getElementById('first_name').value.trim(),
        last_name: document.getElementById('last_name').value.trim()
      });

      const res = await fetchJson(REGISTER_URL, { method: 'POST', body });
      show(res);

      if (res.ok) {
        alert("✅ Registro exitoso. Ahora puedes iniciar sesión.");
        window.location.href = "/account/login/";
      } else {
        alert("❌ Error en el registro. Revisa los campos.");
      }
    });
  </script>
</body>
</html>
